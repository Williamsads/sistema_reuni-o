{% extends "base.html" %}

{% block content %}
<!-- Hero Section with Date -->
<div class="flex flex-col md:flex-row md:justify-between md:items-end mb-12 gap-6">
    <div>
        <h1 class="text-3xl md:text-6xl font-extrabold tracking-tight text-primary mb-2">Painel de Salas</h1>
        <p class="text-base md:text-lg text-slate-500 font-medium">Gestão inteligente de espaços em tempo real.</p>
    </div>
    <div class="bg-white border border-slate-200 px-6 py-3 rounded-2xl text-right shadow-sm min-w-[180px]">
        <div class="text-xs font-bold uppercase tracking-widest text-slate-400 mb-1">Hoje, <span
                id="current-time">00:00:00</span></div>
        <div class="text-xl font-bold text-slate-700" id="current-date">--/--</div>
    </div>
</div>

<!-- Grid de Salas -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for sala in status_salas %}
    <div
        class="group relative bg-white rounded-2xl border border-slate-200 p-6 transition-all hover:shadow-xl hover:border-primary/20">

        <!-- Status Badge (Absolute Top Right) -->
        <div class="absolute top-6 right-6 flex items-center gap-2">
            <span class="relative flex h-4 w-4">
                {% if sala.ocupada %}
                <!-- Camada externa de pulsação -->
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"></span>
                <!-- Camada intermediária de pulsação -->
                <span
                    class="animate-pulse absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-50"></span>
                <!-- Bolinha central sólida -->
                <span
                    class="relative inline-flex rounded-full h-4 w-4 bg-red-500 shadow-lg shadow-red-500/50 blink-red"></span>
                {% else %}
                <span
                    class="relative inline-flex rounded-full h-4 w-4 bg-emerald-500 shadow-md shadow-emerald-500/30"></span>
                {% endif %}
            </span>
            <span class="text-xs font-bold uppercase tracking-wider
                {{ 'text-red-500' if sala.status == 'Ocupada' else 'text-emerald-500' }}">
                {{ sala.status }}
            </span>
        </div>

        <!-- Header -->
        <div class="mb-6">
            <div class="flex items-center gap-1.5 text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                    <circle cx="12" cy="10" r="3" />
                </svg>
                <span>{{ sala.sala.andar or '4º Andar' }}</span>
            </div>
            <h3 class="text-2xl font-bold text-slate-800">{{ sala.sala.nome }}</h3>
        </div>

        <!-- Info Area -->
        <div class="mb-6 h-20">
            {% if sala.status == 'Ocupada' and sala.reserva %}
            <div class="bg-slate-50 rounded-xl p-3 border border-slate-100 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="p-1.5 bg-white rounded-lg text-red-500 shadow-sm">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                    </div>
                    <div>
                        <p class="text-[0.65rem] font-bold text-slate-400 uppercase">Até às</p>
                        <p class="text-sm font-bold text-slate-700 leading-none">{{
                            sala.reserva.fim.strftime('%H:%M') }}</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-[0.65rem] font-bold text-slate-400 uppercase">Por</p>
                    <p class="text-sm font-bold text-slate-700 leading-none truncate max-w-[80px]">{{
                        sala.reserva.nome_solicitante }}</p>
                </div>
            </div>
            {% else %}
            <div
                class="h-full flex items-center gap-3 text-slate-400 bg-slate-50/50 rounded-xl p-3 border border-dashed border-slate-200">
                <div class="p-1.5 bg-emerald-50 rounded-lg text-emerald-500">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                </div>
                <span class="text-sm font-medium">Livre para agendar</span>
            </div>
            {% endif %}
        </div>

        <!-- Action Button -->
        <a href="{{ url_for('main.reservar', sala_id=sala.sala.id) }}"
            class="w-full flex items-center justify-center gap-2 py-3 rounded-lg font-bold text-sm transition-all
            {{ 'bg-slate-100 text-slate-600 hover:bg-slate-200' if sala.status == 'Ocupada' else 'bg-primary text-white hover:bg-[#1e3a8a] shadow-md shadow-primary/10 hover:shadow-lg hover:-translate-y-0.5' }}">
            {% if sala.status == 'Ocupada' %}
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10" />
                <line x1="12" y1="16" x2="12" y2="12" />
                <line x1="12" y1="8" x2="12.01" y2="8" />
            </svg>
            <span>Ver Detalhes</span>
            {% else %}
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19" />
                <line x1="5" y1="12" x2="19" y2="12" />
            </svg>
            <span>Nova Reserva</span>
            {% endif %}
        </a>
    </div>
    {% endfor %}
</div>

<script>
    function updateDateTime() {
        const now = new Date();

        // Update Date
        const dateOptions = { weekday: 'long', day: 'numeric', month: 'long' };
        const dateStr = now.toLocaleDateString('pt-BR', dateOptions);
        document.getElementById('current-date').textContent = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);

        // Update Time
        const timeStr = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        document.getElementById('current-time').textContent = timeStr;
    }

    // Update immediately and then every second
    updateDateTime();
    setInterval(updateDateTime, 1000);
</script>
{% endblock %}